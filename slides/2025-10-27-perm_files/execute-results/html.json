{
  "hash": "9381215e1132b87134f3a3e41efbe238",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Permutation Tests\"\nauthor: \"Jo Hardin\"\nsubtitle: \"October 27 + 29, 2025\"\nformat: \n  revealjs:\n    incremental: false\n    scrollable: true\n    slide-number: true\n    show-slide-number: all\n    embed-resources: true\n    html-math-method: mathjax\nexecute:\n  echo: true\n  warning: false\n  message: false\nbibliography: \n  - ../book.bib\n--- \n\n::: {.cell}\n\n:::\n\n\n\n\n# Agenda  10/27/25\n1. Hypothesis testing\n\n\n# Hypothesis testing\n\nWhether permutation tests or non-computational hypothesis tests (like t-test), hypothesis testing has the same structure.\n\nSee <a href = \"https://st47s.com/DS002R/Notes/13-permutation-tests.html#structure-of-hypothesis-testing\" target = \"_blank\">class notes on hypothesis testing</a>.\n\nn.b., Helper-Hindered example uses a simulation to accomplish the hypothesis test, but it isn't a permutation test becasue we aren't permuting anything!\n\n## Example: helper or hinderer\n\n> In a study reported in the November 2007 issue of *Nature*, researchers investigated whether infants take into account an individual's actions towards others in evaluating that individual as appealing or aversive, perhaps laying for the foundation for social interaction [@hamlin2007]. In other words, do children who aren't even yet talking still form impressions as to someone's friendliness based on their actions? In one component of the study, 10-month-old infants were shown a \"climber\" character (a piece of wood with \"googly\" eyes glued onto it) that could not make it up a hill in two tries. Then the infants were shown two scenarios for the climber's next try, one where the climber was pushed to the top of the hill by another character (the \"helper\" toy) and one where the climber was pushed back down the hill by another character (the \"hinderer\" toy). The infant was alternately shown\nthese two scenarios several times. Then the child was presented with both pieces of wood (the helper and the hinderer characters) and asked to pick one to play with.\n\n## Example: helper or hinderer\n\n\n* <a href = \"https://campuspress.yale.edu/infantlab/media/\" target = \"_blank\">Infant videos</a>\n* <a href = \"https://www.nature.com/articles/nature06288\" target = \"_blank\">\"Social evaluation by preverbal infants\"</a>, *Nature* 2007\n\n\n## Parts of a hypothesis test\n\n* What are the observational units?\n    - infants\n* What is the variable?  What type of variable?\n    - choice of helper or hindered: categorical\n* What is the statistic?\n    - $\\hat{p}$ = proportion of infants who chose helper = 14/16 = 0.875\n* What is the parameter?\n    - p = proportion of all infants who might choose helper (not measurable!)\n    \n## Hypotheses \n\n$H_0$: Null hypothesis. Babies (or rather, the population of babies under consideration) have no inherent preference for the helper or the hinderer shape.\n\n$H_A$: Alternative hypothesis. Babies (or rather, the population of babies under consideration) are more likely to prefer the helper shape over the hinderer shape.  \n\n## p-value\n\n> **p-value** is the probability of our data or more extreme if nothing interesting is going on.\n\n|           completely arbitrary cutoff | $\\rightarrow$ | generally accepted conclusion          |\n|---------------------------:|:-------------:|---------------------------------------------|\n|           p-value $>$ 0.10 | $\\rightarrow$ | no evidence against the null model          |\n| 0.05 $<$ p-value $<$ 0.10 | $\\rightarrow$ | moderate evidence against the null model    |\n| 0.01 $<$ p-value $<$ 0.05 | $\\rightarrow$ | strong evidence against the null model      |\n|          p-value $<$ 0.01 | $\\rightarrow$ | very strong evidence against the null model |\n\n## Computation\n\nFirst find the statistic\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# to control the randomness\nset.seed(47)\n\n# first create a data frame with the Infant data\nInfants <- read.delim(\"http://www.rossmanchance.com/iscam3/data/InfantData.txt\")\n\n# find the observed number of babies who chose the helper\nhelp_obs <- Infants |> \n  summarize(prop_help = mean(choice == \"helper\")) |> \n  pull()\nhelp_obs\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.875\n```\n\n\n:::\n:::\n\n\n\n## Computation\n\nFind the sampling distribution under the condition that the null hypothesis is true.\n\n::: {.panel-tabset}\n\n## function\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# write a function to simulate a set of infants who are \n# equally likely to choose the helper or the hinderer\n\nrandom_choice <- function(rep, num_babies){\n  choice = sample(c(\"helper\", \"hinderer\"), size = num_babies,\n                  replace = TRUE, prob = c(0.5, 0.5))\n  return(mean(choice == \"helper\"))\n}\n```\n:::\n\n\n\n## repeat\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# repeat the function many times\nmap_dbl(c(1:10), random_choice, num_babies = 16)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 0.6875 0.3750 0.4375 0.3750 0.5000 0.5000 0.6250 0.4375 0.6875 0.6250\n```\n\n\n:::\n\n```{.r .cell-code}\nnum_exper <- 5000\nhelp_random <- map_dbl(c(1:num_exper), random_choice, \n                            num_babies = 16)\n```\n:::\n\n\n\n## viz\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](2025-10-27-perm_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n\n## viz code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# visualize null sampling distribution\nhelp_random |> \n  data.frame() |> \n  ggplot(aes(x = help_random)) + \n  geom_histogram() + \n  labs(x = \"proportion of babies who chose the helper\",\n       title = \"sampling distribution when null hypothesis is true\",\n       subtitle = \"that is, no inherent preference for helper or hinderer\")\n```\n:::\n\n\n\n:::\n\n\n## Computation\n\nAre the null values consistent with the observed value?\n\n::: {.panel-tabset}\n\n## viz\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](2025-10-27-perm_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n\n## p-value\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# the p-value!\nsum(help_random >= help_obs) / num_exper\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.0022\n```\n\n\n:::\n:::\n\n\n\n## viz code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# visualize null sampling distribution\nhelp_random |> \n  data.frame() |> \n  ggplot(aes(x = help_random)) + \n  geom_histogram() + \n  geom_vline(xintercept = help_obs, color = \"red\") + \n  labs(x = \"proportion of babies who chose the helper\",\n       title = \"sampling distribution when null hypothesis is true\",\n       subtitle = \"that is, no inherent preference for helper or hinderer\")\n```\n:::\n\n\n\n:::\n\n\n\n##  All together:  structure of a hypothesis test\n\n* decide on a research question (which will determine the test)\n* collect data, **specify** the variables of interest\n* state the null (and alternative) **hypothesis** values (often statements about parameters)\n   - the null claim is the science we want to reject\n   - the alternative claim is the science we want to demonstrate\n* **generate** a (null) sampling distribution to describe the variability of the statistic that was **calculated** along the way\n* **visualize** the distribution of the statistics under the null model\n* **get p-value** to measure the consistency of the observed statistic and the possible values of the statistic under the null model\n* make a conclusion using words that describe the research setting\n\n## Hypotheses\n\n* **Hypothesis Testing** compares data to the expectation of a specific null hypothesis.  If the data are unusual, assuming that the null hypothesis is true, then the null hypothesis is rejected.  \n\n* The **Null Hypothesis**, $H_0$, is a specific statement about a population made for the purposes of argument.  A good null hypothesis is a statement that would be interesting to reject. \n\n* The **Alternative Hypothesis**, $H_A$, is a specific statement about a population that is in the researcher's interest to demonstrate.  Typically, the alternative hypothesis contains all the values of the population that are not included in the null hypothesis. \n\n* In a **two-sided** (or two-tailed) test, the alternative hypothesis includes values on both sides of the value specified by the null hypothesis.\n\n* In a **one-sided** (or one-tailed) test, the alternative hypothesis includes parameter values on only one side of the value specified by the null hypothesis. $H_0$ is rejected only if the data depart from it in the direction stated by $H_A$.\n\n\n\n# Agenda 10/29/25\n1. Two variable permutation tests\n\nSame hypothesis testing ideas: now we have **two** variables and we permute one of them to make the null hypothesis true.\n \n## Statistics Without the Agonizing Pain\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![John Rauser of Pintrest (now Amazon), speaking at Strata + Hadoop 2014. https://blog.revolutionanalytics.com/2014/10/statistics-doesnt-have-to-be-that-hard.html](../images/rauser.png){fig-alt='Image of John Rauser who gave a keynote address  on permutation tests at the Strat + Hadoop conference in 2014.' width=40%}\n:::\n:::\n\n\n\n\n\n## Logic of hypothesis tests\n\n1. Choose a statistic that measures the effect. \n\n2. Construct the sampling distribution under $H_0$.\n\n3. Locate the observed statistic in the null sampling distribution.\n\n4. **p-value**  is the probability of the observed data or more extreme if the null hypothesis is true\n\n## Logic of permutation tests\n\n1. Choose a test statistic.\n\n2. Shuffle the data (force the null hypothesis to be true).  Using the shuffled statistics, create a null sampling distribution of the test statistic (under $H_0$).\n\n4. Find the observed test statistic on the null sampling distribution.\n\n5. Compute the p-value (observed data or more extreme).  The p-value can be one or two-sided.\n\n## Applet for two sample permutation tests\n\n* <a href = \"https://www.rossmanchance.com/applets/2021/anovashuffle/AnovaShuffle.htm?hideExtras=2\" target = \"_blank\">permutation test for two samples</a> from Rossman Chance applets.\n\n## High School & Beyond survey\n\n\nData: 200 randomly selected observations from the High School and Beyond survey, conducted on high school seniors by the National Center for Educational Statistics.\n\nResearch Question:  in the population, do private school kids have a higher math score on average?\n\n$$H_0: \\mu_{private} = \\mu_{public}$$\n$$H_A: \\mu_{private} > \\mu_{public}$$\n\n$\\mu$ is the average math score in the population.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(openintro)\nhsb2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 200 × 11\n      id gender race      ses   schtyp prog   read write  math science\n   <int> <chr>  <chr>     <fct> <fct>  <fct> <int> <int> <int>   <int>\n 1    70 male   white     low   public gene…    57    52    41      47\n 2   121 female white     midd… public voca…    68    59    53      63\n 3    86 male   white     high  public gene…    44    33    54      58\n 4   141 male   white     high  public voca…    63    44    47      53\n 5   172 male   white     midd… public acad…    47    52    57      53\n 6   113 male   white     midd… public acad…    44    52    51      63\n 7    50 male   african … midd… public gene…    50    59    42      53\n 8    11 male   hispanic  midd… public acad…    34    46    45      39\n 9    84 male   white     midd… public gene…    63    57    54      58\n10    48 male   african … midd… public acad…    57    55    52      50\n# ℹ 190 more rows\n# ℹ 1 more variable: socst <int>\n```\n\n\n:::\n:::\n\n\n\n\n\n## Summary of the variables\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhsb2 |> \n  group_by(schtyp) |> \n  summarize(ave_math = mean(math),\n            med_math = median(math))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  schtyp  ave_math med_math\n  <fct>      <dbl>    <dbl>\n1 public      52.2     52  \n2 private     54.8     53.5\n```\n\n\n:::\n:::\n\n\n\n## Visualize the relationship of interest\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhsb2 |> \n  ggplot(aes(x = schtyp, y = math)) + \n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](2025-10-27-perm_files/figure-revealjs/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n\n\n## Calculate the observed statistic(s)\n\nFor fun, we are calculating both the difference in averages as well as the difference in medians.  That is, we have **two** different observed summary statistics to work with.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhsb2 |> \n  group_by(schtyp) |> \n  summarize(ave_math = mean(math),\n            med_math = median(math))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  schtyp  ave_math med_math\n  <fct>      <dbl>    <dbl>\n1 public      52.2     52  \n2 private     54.8     53.5\n```\n\n\n:::\n\n```{.r .cell-code}\nhsb2 |> \n  group_by(schtyp) |> \n  summarize(ave_math = mean(math),\n            med_math = median(math)) |> \n  summarize(ave_diff = diff(ave_math),\n            med_diff = diff(med_math))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  ave_diff med_diff\n     <dbl>    <dbl>\n1     2.51      1.5\n```\n\n\n:::\n:::\n\n\n\n\n## Generate a null sampling distribution.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperm_data <- function(rep, data){\n  data |> \n    select(schtyp, math) |> \n    mutate(math_perm = sample(math, replace = FALSE)) |> \n    group_by(schtyp) |> \n    summarize(obs_ave = mean(math),\n              obs_med = median(math),\n              perm_ave = mean(math_perm),\n              perm_med = median(math_perm)) |> \n    summarize(obs_ave_diff = diff(obs_ave),\n              obs_med_diff = diff(obs_med),\n              perm_ave_diff = diff(perm_ave),\n              perm_med_diff = diff(perm_med),\n              rep = rep)\n}\n\nmap(c(1:10), perm_data, data = hsb2) |> \n  list_rbind()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 5\n   obs_ave_diff obs_med_diff perm_ave_diff perm_med_diff   rep\n          <dbl>        <dbl>         <dbl>         <dbl> <int>\n 1         2.51          1.5         2.62            2.5     1\n 2         2.51          1.5         0.757          -1       2\n 3         2.51          1.5         1.65            2       3\n 4         2.51          1.5        -0.805          -0.5     4\n 5         2.51          1.5         1.80            2.5     5\n 6         2.51          1.5         2.92            3       6\n 7         2.51          1.5         1.91            2.5     7\n 8         2.51          1.5        -2.55           -3.5     8\n 9         2.51          1.5        -1.21           -3       9\n10         2.51          1.5         1.32            1      10\n```\n\n\n:::\n:::\n\n\n\n\n## Visualize the null sampling distribution (average)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(47)\nperm_stats <- \n  map(c(1:500), perm_data, data = hsb2) |> \n  list_rbind() \n\nperm_stats |> \n  ggplot(aes(x = perm_ave_diff)) + \n  geom_histogram() + \n  geom_vline(aes(xintercept = obs_ave_diff), color = \"red\")\n```\n\n::: {.cell-output-display}\n![](2025-10-27-perm_files/figure-revealjs/unnamed-chunk-16-1.png){width=960}\n:::\n:::\n\n\n\n\n## Visualize the null sampling distribution (median)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperm_stats |> \n  ggplot(aes(x = perm_med_diff)) + \n  geom_histogram() + \n  geom_vline(aes(xintercept = obs_med_diff), color = \"red\")\n```\n\n::: {.cell-output-display}\n![](2025-10-27-perm_files/figure-revealjs/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n\n\n## p-value\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperm_stats |> \n  summarize(p_val_ave = mean(perm_ave_diff > obs_ave_diff),\n            p_val_med = mean(perm_med_diff > obs_med_diff))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  p_val_ave p_val_med\n      <dbl>     <dbl>\n1     0.086      0.27\n```\n\n\n:::\n:::\n\n\n\n\n## Conclusion\n\nFrom these data, the observed differences seem to be consistent with the distribution of differences in the null sampling distribution.\n\nThere is no evidence to reject the null hypothesis.\n\nWe cannot claim that in the population the **average** math scores for private school kids is larger than the **average** math scores for public school kids (p-value = 0.086).\n\nWe cannot claim that in the population the **median** math scores for private school kids is larger than the **median** math scores for public school kids (p-value = 0.27).\n\n## Two-sided test:\n\n$H_0: \\mu_{private} = \\mu_{public}$ and $H_A: \\mu_{private} \\ne \\mu_{public}$\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](2025-10-27-perm_files/figure-revealjs/unnamed-chunk-19-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n## Two-sided p-value\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperm_stats |> \n    summarize(p_val_ave = \n                mean(perm_ave_diff > obs_ave_diff | \n                       perm_ave_diff < -obs_ave_diff),\n              p_val_med = \n              mean(perm_med_diff > obs_med_diff | \n                     perm_med_diff < -obs_med_diff))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  p_val_ave p_val_med\n      <dbl>     <dbl>\n1     0.154     0.534\n```\n\n\n:::\n:::\n\n\n\n## Two-sided conclusion\n\nFrom these data, the observed differences seem to be consistent with the distribution of differences in the null sampling distribution.\n\nThere is no evidence to reject the null hypothesis.\n\nWe cannot claim that there is a **difference** in average math scores in the population (p-value = 0.154).\n\nWe cannot claim that there is a **difference** in median math scores int he population (p-value = 0.534).\n\n## References\n\n\n\n\n\n\n\n",
    "supporting": [
      "2025-10-27-perm_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}