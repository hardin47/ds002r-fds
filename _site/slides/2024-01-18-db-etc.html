<!DOCTYPE html>
<html lang="en"><head>
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.450">

  <meta name="author" content="Jo Hardin">
  <meta name="dcterms.date" content="2024-01-18">
  <title>Data Science, the SQL - SQL Extras</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link href="../site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
  <link href="../site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">SQL Extras</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Jo Hardin 
</div>
</div>
</div>

  <p class="date">2024-01-18</p>
</section>
<section id="back-to-the-flights" class="slide level2 unnumbered">
<h2>Back to the flights</h2>
<p>The examples below use the <code>airlines</code> database, including the <code>flights</code>, <code>carriers</code>, <code>airports</code>, and <code>planes</code> tables.</p>
</section>
<section id="efficiencies" class="slide level2 scrollable">
<h2>Efficiencies</h2>
<p>Reconsider this analogy:</p>
<blockquote>
<p>Each library (<code>database</code>) has books (<code>table</code>s). Each book (<code>table</code>) has pages (rows). Each page (row) has a unique page number to identify it (<code>key</code> value); to find a particular page, you sort through the page numbers (<code>key</code> values). But it isn’t immediately obvious where the particular page of interest is, you might have to page through the book a little bit to find the page of interest. It would be easier if you had several bookmarks throughout the book to anchor some of the page numbers. For example, if you want page 1047 and you have a bookmark on page 1050, you only have to turn back three pages. The bookmark is an <code>index</code>, it helps you find the desired rows much more quickly.<sup>1</sup></p>
</blockquote>
<aside><ol class="aside-footnotes"><li id="fn1"><p>Analogy taken from: https://www.quora.com/profile/Lara-Mazilu</p></li></ol></aside></section>
<section id="keys" class="slide level2">
<h2><code>KEY</code>s</h2>
<p>Keys are unique identifiers for each row, used primarily for connecting tables. Keys are generally not helpful for efficiency, but they are important for data integrity and relationships between tables. A key is a pointer that identifies a record. In practice, a key is one or more columns that are earmarked to uniquely identify a record in a table. Keys serve two main purposes:</p>
<ol type="1">
<li>They provide constraints on the column such as that it can’t store duplicate or null values.</li>
<li>They are also used to generate relationships among different tables.</li>
</ol>
</section>
<section id="indexes" class="slide level2 scrollable">
<h2><code>INDEX</code>es</h2>
<ul>
<li><p>By indexing the rows, <strong>SQL</strong> is able to optimize sorting and joining tables.</p></li>
<li><p>The index is created in advance (when the table is created) and saved to disk, which can take up substantial space on the disk.</p></li>
<li><p>Sometimes more than one variable is used to index the table.</p></li>
<li><p>There are trade-offs to having a lot of indexes (disk space but fast wrangling) versus a few indexes (slow wrangling but less space).</p></li>
<li><p>A table may have more than one index but you shouldn’t add indexes to every column in a table, as these have to be updated for every addition/update/delete to the column.</p></li>
<li><p>Indexes should be added to columns that are frequently included in queries.</p></li>
</ul>
</section>
<section id="show-indexes" class="slide level2 scrollable">
<h2><code>SHOW INDEXES</code></h2>
<p>Notice that the <code>planes</code> table has a single <code>PRIMARY</code> key. That primary key is used to index the table. The <code>flights</code> table has no <code>PRIMARY</code> key, but it does have six different indexes: <code>Year</code>, <code>Date</code>, <code>Origin</code>, <code>Dest</code>, <code>Carrier</code>, and <code>tailNum</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1"></a>SHOW <span class="kw">INDEXES</span> <span class="kw">FROM</span> planes;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
1 records
</caption>
<thead>
<tr>
<th style="text-align:left;">
Table
</th>
<th style="text-align:right;">
Non_unique
</th>
<th style="text-align:left;">
Key_name
</th>
<th style="text-align:right;">
Seq_in_index
</th>
<th style="text-align:left;">
Column_name
</th>
<th style="text-align:left;">
Collation
</th>
<th style="text-align:right;">
Cardinality
</th>
<th style="text-align:right;">
Sub_part
</th>
<th style="text-align:left;">
Packed
</th>
<th style="text-align:left;">
Null
</th>
<th style="text-align:left;">
Index_type
</th>
<th style="text-align:left;">
Comment
</th>
<th style="text-align:left;">
Index_comment
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
planes
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
PRIMARY
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
tailnum
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
3322
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>

</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1"></a>SHOW <span class="kw">INDEXES</span> <span class="kw">FROM</span> flights;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
8 records
</caption>
<thead>
<tr>
<th style="text-align:left;">
Table
</th>
<th style="text-align:right;">
Non_unique
</th>
<th style="text-align:left;">
Key_name
</th>
<th style="text-align:right;">
Seq_in_index
</th>
<th style="text-align:left;">
Column_name
</th>
<th style="text-align:left;">
Collation
</th>
<th style="text-align:right;">
Cardinality
</th>
<th style="text-align:right;">
Sub_part
</th>
<th style="text-align:left;">
Packed
</th>
<th style="text-align:left;">
Null
</th>
<th style="text-align:left;">
Index_type
</th>
<th style="text-align:left;">
Comment
</th>
<th style="text-align:left;">
Index_comment
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Year
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
year
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
YES
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Date
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
year
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
YES
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Date
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
month
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
YES
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Date
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
day
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2712
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
YES
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Origin
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
origin
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2267
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Dest
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
dest
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2267
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Carrier
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
carrier
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
134
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
tailNum
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
tailnum
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
37862
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
YES
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="show-indexes-1" class="slide level2 scrollable">
<h2><code>SHOW INDEXES</code></h2>
<p>The values output by <code>SHOW INDEXES</code> are:<sup>1</sup></p>
<ul>
<li><p><code>Table</code>: The name of the table.</p></li>
<li><p><code>Non_unique</code>: 0 if the index cannot contain duplicates, 1 if it can.</p></li>
<li><p><code>Key_name</code>: The name of the index. If the index is the primary key, the name is always <code>PRIMARY</code>.</p></li>
<li><p><code>Seq_in_index</code>: The column sequence number in the index, starting with 1.</p></li>
<li><p><code>Column_name</code>: The column name. See also the description for the Expression column.</p></li>
<li><p><code>Collation</code>: How the column is sorted in the index. This can have values A (ascending), D (descending), or NULL (not sorted).</p></li>
<li><p><code>Cardinality</code>: An estimate of the number of unique values in the index.</p></li>
<li><p><code>Sub_part</code>: The index prefix. That is, the number of indexed characters if the column is only partly indexed, NULL if the entire column is indexed.</p></li>
<li><p><code>Packed</code>: Indicates how the key is packed. <code>NULL</code> if it is not.</p></li>
<li><p><code>Null</code>: Contains <code>YES</code> if the column may contain <code>NULL</code> values and ’’ if not.</p></li>
<li><p><code>Index_type</code>: The index method used (<code>BTREE</code>, <code>FULLTEXT</code>, <code>HASH</code>, <code>RTREE</code>).</p></li>
<li><p><code>Comment</code>: Information about the index not described in its own column, such as disabled if the index is disabled.</p></li>
<li><p><code>Index_comment</code>: Any comment provided for the index with a <code>COMMENT</code> attribute when the index was created.</p></li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn2"><p>Taken from: https://dev.mysql.com/doc/refman/8.0/en/show-index.html</p></li></ol></aside></section>
<section id="partitioning" class="slide level2">
<h2>Partitioning</h2>
<p>Another way to speed up query retrievals is to partition the data tables. If, for example, the SNL queries were always done by year, then the <code>episodes</code> table could be partitioned such that they are stored as separate tables (one per <code>year</code>). The partitioning functions as an index on <code>year</code>. The user would not be able to tell the difference between the unpartitioned <code>episodes</code> table and the partitioned one. However, queries done by <code>year</code> would be faster. Queries done grouped in another way would be slower.</p>
</section>
<section id="querying-quickly" class="slide level2 scrollable">
<h2>Querying quickly</h2>
<p>Indexes are built to accommodate the specific queries that are most likely to be run. However, you might not know which queries are going to be run, so it isn’t always obviously how to index a table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1"></a>SHOW <span class="kw">INDEXES</span> <span class="kw">FROM</span> flights;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
8 records
</caption>
<thead>
<tr>
<th style="text-align:left;">
Table
</th>
<th style="text-align:right;">
Non_unique
</th>
<th style="text-align:left;">
Key_name
</th>
<th style="text-align:right;">
Seq_in_index
</th>
<th style="text-align:left;">
Column_name
</th>
<th style="text-align:left;">
Collation
</th>
<th style="text-align:right;">
Cardinality
</th>
<th style="text-align:right;">
Sub_part
</th>
<th style="text-align:left;">
Packed
</th>
<th style="text-align:left;">
Null
</th>
<th style="text-align:left;">
Index_type
</th>
<th style="text-align:left;">
Comment
</th>
<th style="text-align:left;">
Index_comment
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Year
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
year
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
YES
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Date
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
year
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
YES
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Date
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
month
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
YES
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Date
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
day
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2712
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
YES
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Origin
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
origin
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2267
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Dest
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
dest
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2267
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Carrier
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
carrier
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
134
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flights
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
tailNum
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
tailnum
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
37862
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
YES
</td>
<td style="text-align:left;">
BTREE
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="explain-with-distance" class="slide level2 scrollable">
<h2><code>EXPLAIN</code> with <code>distance</code></h2>
<p><code>EXPLAIN</code> communicates how onerous the query is, without actually running it—saving you the time of having to wait for it to execute.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">EXPLAIN</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> flights <span class="kw">WHERE</span> distance <span class="op">&gt;</span> <span class="dv">3000</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
1 records
</caption>
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
select_type
</th>
<th style="text-align:left;">
table
</th>
<th style="text-align:left;">
partitions
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:left;">
possible_keys
</th>
<th style="text-align:left;">
key
</th>
<th style="text-align:left;">
key_len
</th>
<th style="text-align:left;">
ref
</th>
<th style="text-align:right;">
rows
</th>
<th style="text-align:right;">
filtered
</th>
<th style="text-align:left;">
Extra
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
SIMPLE
</td>
<td style="text-align:left;">
flights
</td>
<td style="text-align:left;">
p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14,p15,p16,p17,p18,p19,p20,p21,p22,p23,p24,p25,p26,p27,p28,p29,p30,p31,p32
</td>
<td style="text-align:left;">
ALL
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
47932811
</td>
<td style="text-align:right;">
33.3
</td>
<td style="text-align:left;">
Using where
</td>
</tr>
</tbody>

</table>
</div>
</div>
<p>If we were to run a query for long flights using the <code>distance</code> column the server will have to inspect <strong>each</strong> of the 48 million rows, because <code>distance</code> is not indexed. A query on a non-indexed variable is the slowest possible search and is often called a table scan. The 48 million number that you see in the rows column is an estimate of the number of rows that <strong>MySQL</strong> will have to consult in order to process your query. In general, more rows mean a slower query.</p>
</section>
<section id="explain-with-year" class="slide level2">
<h2><code>EXPLAIN</code> with <code>year</code></h2>
<p>A search for recent flights using the <code>year</code> column, which has an index built on it, considers many fewer rows (about 6.3 million, those flights in 2013).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">EXPLAIN</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> flights <span class="kw">WHERE</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">2013</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
1 records
</caption>
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
select_type
</th>
<th style="text-align:left;">
table
</th>
<th style="text-align:left;">
partitions
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:left;">
possible_keys
</th>
<th style="text-align:left;">
key
</th>
<th style="text-align:left;">
key_len
</th>
<th style="text-align:left;">
ref
</th>
<th style="text-align:right;">
rows
</th>
<th style="text-align:right;">
filtered
</th>
<th style="text-align:left;">
Extra
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
SIMPLE
</td>
<td style="text-align:left;">
flights
</td>
<td style="text-align:left;">
p27
</td>
<td style="text-align:left;">
ALL
</td>
<td style="text-align:left;">
Year,Date
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
6369482
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:left;">
Using where
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="cardinality-x-rows" class="slide level2">
<h2><code>Cardinality</code> x <code>rows</code></h2>
<p>The <code>Cardinality</code> from <code>SHOW INDEXES</code> times the <code>rows</code> from <code>EXPLAIN</code> is roughly the total number of rows in the dataframe.</p>
</section>
<section id="explain-with-year-and-month" class="slide level2">
<h2><code>EXPLAIN</code> with <code>year</code> and <code>month</code></h2>
<p>In a search by <code>year</code> and <code>month</code>, <strong>SQL</strong> uses the <code>Date</code> index. Only 700,000 rows are searched, those in June of 2013.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">EXPLAIN</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> flights <span class="kw">WHERE</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">2013</span> <span class="kw">AND</span> <span class="dt">month</span> <span class="op">=</span> <span class="dv">6</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
1 records
</caption>
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
select_type
</th>
<th style="text-align:left;">
table
</th>
<th style="text-align:left;">
partitions
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:left;">
possible_keys
</th>
<th style="text-align:left;">
key
</th>
<th style="text-align:left;">
key_len
</th>
<th style="text-align:left;">
ref
</th>
<th style="text-align:right;">
rows
</th>
<th style="text-align:right;">
filtered
</th>
<th style="text-align:left;">
Extra
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
SIMPLE
</td>
<td style="text-align:left;">
flights
</td>
<td style="text-align:left;">
p27
</td>
<td style="text-align:left;">
ref
</td>
<td style="text-align:left;">
Year,Date
</td>
<td style="text-align:left;">
Date
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
const,const
</td>
<td style="text-align:right;">
714535
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="explain-with-month" class="slide level2 scrollable">
<h2><code>EXPLAIN</code> with <code>month</code></h2>
<p>If we search for particular months across all years, the indexing does not help at all. The query results in a table scan.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">EXPLAIN</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> flights <span class="kw">WHERE</span> <span class="dt">month</span> <span class="op">=</span> <span class="dv">6</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
1 records
</caption>
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
select_type
</th>
<th style="text-align:left;">
table
</th>
<th style="text-align:left;">
partitions
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:left;">
possible_keys
</th>
<th style="text-align:left;">
key
</th>
<th style="text-align:left;">
key_len
</th>
<th style="text-align:left;">
ref
</th>
<th style="text-align:right;">
rows
</th>
<th style="text-align:right;">
filtered
</th>
<th style="text-align:left;">
Extra
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
SIMPLE
</td>
<td style="text-align:left;">
flights
</td>
<td style="text-align:left;">
p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14,p15,p16,p17,p18,p19,p20,p21,p22,p23,p24,p25,p26,p27,p28,p29,p30,p31,p32
</td>
<td style="text-align:left;">
ALL
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
47932811
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Using where
</td>
</tr>
</tbody>

</table>
</div>
</div>
<p>Although month is part of the <code>Date</code> index, it is the <strong>second</strong> column in the index, and thus it doesn’t help us when we aren’t filtering on year. Thus, if it were common for our users to search on month without year, it would probably be worth building an index on month. Were we to actually run these queries, there would be a significant difference in computational time.</p>
</section>
<section id="explain-with-join---faster" class="slide level2 scrollable">
<h2><code>EXPLAIN</code> with <code>JOIN</code> - faster</h2>
<p>The cardinality of the index on <code>tailnum</code> is large (the number of rows in <code>flights</code> associated with each unique value of <code>tailnum</code> is small).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">EXPLAIN</span> </span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> planes p </span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="kw">LEFT</span> <span class="kw">JOIN</span> flights o <span class="kw">ON</span> p.tailnum <span class="op">=</span> o.TailNum</span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="kw">WHERE</span> manufacturer <span class="op">=</span> <span class="st">'BOEING'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
2 records
</caption>
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
select_type
</th>
<th style="text-align:left;">
table
</th>
<th style="text-align:left;">
partitions
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:left;">
possible_keys
</th>
<th style="text-align:left;">
key
</th>
<th style="text-align:left;">
key_len
</th>
<th style="text-align:left;">
ref
</th>
<th style="text-align:right;">
rows
</th>
<th style="text-align:right;">
filtered
</th>
<th style="text-align:left;">
Extra
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
SIMPLE
</td>
<td style="text-align:left;">
p
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
ALL
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
3322
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Using where
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
SIMPLE
</td>
<td style="text-align:left;">
o
</td>
<td style="text-align:left;">
p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14,p15,p16,p17,p18,p19,p20,p21,p22,p23,p24,p25,p26,p27,p28,p29,p30,p31,p32
</td>
<td style="text-align:left;">
ref
</td>
<td style="text-align:left;">
tailNum
</td>
<td style="text-align:left;">
tailNum
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
airlines.p.tailnum
</td>
<td style="text-align:right;">
1266
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="explain-with-join---slower" class="slide level2 scrollable">
<h2><code>EXPLAIN</code> with <code>JOIN</code> - slower</h2>
<ul>
<li>The cardinality of the index on <code>year</code> is small (the number of rows in <code>flights</code> associated with each unique <code>year</code> is large).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">EXPLAIN</span> </span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> planes p </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="kw">LEFT</span> <span class="kw">JOIN</span> flights o <span class="kw">ON</span> p.<span class="dt">Year</span> <span class="op">=</span> o.<span class="dt">Year</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="kw">WHERE</span> manufacturer <span class="op">=</span> <span class="st">'BOEING'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
2 records
</caption>
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
select_type
</th>
<th style="text-align:left;">
table
</th>
<th style="text-align:left;">
partitions
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:left;">
possible_keys
</th>
<th style="text-align:left;">
key
</th>
<th style="text-align:left;">
key_len
</th>
<th style="text-align:left;">
ref
</th>
<th style="text-align:right;">
rows
</th>
<th style="text-align:right;">
filtered
</th>
<th style="text-align:left;">
Extra
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
SIMPLE
</td>
<td style="text-align:left;">
p
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
ALL
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
3322
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Using where
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
SIMPLE
</td>
<td style="text-align:left;">
o
</td>
<td style="text-align:left;">
p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14,p15,p16,p17,p18,p19,p20,p21,p22,p23,p24,p25,p26,p27,p28,p29,p30,p31,p32
</td>
<td style="text-align:left;">
ref
</td>
<td style="text-align:left;">
Year,Date
</td>
<td style="text-align:left;">
Year
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
airlines.p.year
</td>
<td style="text-align:right;">
6450117
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:left;">
Using where
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="sql-in-dbplyr" class="slide level2">
<h2><strong>SQL</strong> in <strong>dbplyr</strong></h2>
<p>As mentioned previously, <strong>dbplyr</strong> doesn’t translate every R command into SQL. After all, SQL is not a statistical software and doesn’t, for example, have a mechanism for creating data visualizations. To track which R commands are connected to SQL see the <a href="https://dbplyr.tidyverse.org/reference/" target="_blank">dbplyr reference sheet</a>.</p>
</section>
<section id="median" class="slide level2 scrollable">
<h2>Median</h2>
<p>Let’s start with an example, calculating the median <code>alt</code>itude in the <code>airports</code> table.<sup>1</sup></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>airports <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con_air, <span class="st">"airports"</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="fu">head</span>(airports)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [6 x 9]
# Database: mysql  [mdsr_public@mdsr.cdc7tgkkqd0n.us-east-1.rds.amazonaws.com:NA/airlines]
  faa   name                           lat   lon   alt    tz dst   city  country
  &lt;chr&gt; &lt;chr&gt;                        &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  
1 04G   Lansdowne Airport             41.1 -80.6  1044    -5 A     Youn… United…
2 06A   Moton Field Municipal Airpo…  32.5 -85.7   264    -6 A     Tusk… United…
3 06C   Schaumburg Regional           42.0 -88.1   801    -6 A     Scha… United…
4 06N   Randall Airport               41.4 -74.4   523    -5 A     Midd… United…
5 09J   Jekyll Island Airport         31.1 -81.4    11    -5 A     Jeky… United…
6 0A9   Elizabethton Municipal Airp…  36.4 -82.2  1593    -5 A     Eliz… United…</code></pre>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn3"><p>Example taken from: https://sebhastian.com/mysql-median/</p></li></ol></aside></section>
<section id="median-1" class="slide level2">
<h2>Median</h2>
<p>It <em>looks</em> like <code>show_query()</code> is providing <strong>SQL</strong> code for calculating the median!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>median_query <span class="ot">&lt;-</span> airports <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">summarize</span>(<span class="at">med_alt =</span> <span class="fu">median</span>(alt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="fu">show_query</span>(median_query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY `alt`) AS `med_alt`
FROM `airports`</code></pre>
</div>
</div>
</section>
<section id="median-2" class="slide level2">
<h2>Median</h2>
<p>But when the <strong>SQL</strong> code is run, it doesn’t seem to work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">SELECT</span> <span class="fu">PERCENTILE_CONT</span>(<span class="fl">0.5</span>) WITHIN <span class="kw">GROUP</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> `alt`) <span class="kw">AS</span> `med_alt`</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw">FROM</span> `airports`;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'GROUP (ORDER BY `alt`) AS `med_alt`
FROM `airports`' at line 1 [1064]</code></pre>
</div>
</div>
</section>
<section id="median-3" class="slide level2">
<h2>Median</h2>
<p>What happens when we computer the median on the <code>tbl</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>airports <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">summarize</span>(<span class="at">med_alt =</span> <span class="fu">median</span>(alt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `collect()`:
! Failed to collect lazy table.
Caused by error:
! You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'GROUP (ORDER BY `alt`) AS `med_alt`
FROM `airports`
LIMIT 7' at line 1 [1064]</code></pre>
</div>
</div>
</section>
<section id="median-4" class="slide level2">
<h2>Median</h2>
<p>How can the median be calculated in <strong>SQL</strong>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">SET</span> @row_index <span class="op">:=</span> <span class="op">-</span><span class="dv">1</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(subquery.alt) <span class="kw">AS</span> median_value</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="kw">FROM</span> (</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="kw">SELECT</span> @row_index<span class="op">:=</span>@row_index <span class="op">+</span> <span class="dv">1</span> <span class="kw">AS</span> row_index, alt</span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="kw">FROM</span> airports</span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> alt</span>
<span id="cb19-6"><a href="#cb19-6"></a>) <span class="kw">AS</span> subquery</span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="kw">WHERE</span> subquery.row_index <span class="kw">IN</span> (<span class="fu">FLOOR</span>(@row_index <span class="op">/</span> <span class="dv">2</span>), <span class="fu">CEIL</span>(@row_index <span class="op">/</span> <span class="dv">2</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
1 records
</caption>
<thead>
<tr>
<th style="text-align:right;">
median_value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
476
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="median-5" class="slide level2 scrollable">
<h2>Median</h2>
<p>Let’s break down what the code is doing… First, set the <code>row_index</code> to -1 and iterate through by adding +1 for each row. Then concatenate the <code>row_index</code> information onto our table of interest. (Basically, create a column that gives a row value to the dataset, sorted by <code>alt</code>itude.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">SET</span> @row_index <span class="op">:=</span> <span class="op">-</span><span class="dv">1</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">SELECT</span> @row_index<span class="op">:=</span>@row_index <span class="op">+</span> <span class="dv">1</span> <span class="kw">AS</span> row_index, alt</span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="kw">FROM</span> airports</span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> alt</span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
Displaying records 1 - 10
</caption>
<thead>
<tr>
<th style="text-align:left;">
row_index
</th>
<th style="text-align:right;">
alt
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
-54
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
-42
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
9
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="median-6" class="slide level2 scrollable">
<h2>Median</h2>
<p>Next, filter the data to include only the middle row or two rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">SET</span> @row_index <span class="op">:=</span> <span class="op">-</span><span class="dv">1</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="kw">FROM</span> (</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="kw">SELECT</span> @row_index<span class="op">:=</span>@row_index <span class="op">+</span> <span class="dv">1</span> <span class="kw">AS</span> row_index, alt</span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="kw">FROM</span> airports</span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> alt</span>
<span id="cb23-6"><a href="#cb23-6"></a>) <span class="kw">AS</span> subquery</span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="kw">WHERE</span> subquery.row_index <span class="kw">IN</span> (<span class="fu">FLOOR</span>(@row_index <span class="op">/</span> <span class="dv">2</span>), <span class="fu">CEIL</span>(@row_index <span class="op">/</span> <span class="dv">2</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
2 records
</caption>
<thead>
<tr>
<th style="text-align:left;">
row_index
</th>
<th style="text-align:right;">
alt
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
728
</td>
<td style="text-align:right;">
474
</td>
</tr>
<tr>
<td style="text-align:left;">
729
</td>
<td style="text-align:right;">
477
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="median-7" class="slide level2 scrollable">
<h2>Median</h2>
<p>The last step is to average the middle row(s). If only one row is pulled out in the previous query, then only one row will be averaged (which the computer does happily).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">SET</span> @row_index <span class="op">:=</span> <span class="op">-</span><span class="dv">1</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(subquery.alt) <span class="kw">AS</span> median_value</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="kw">FROM</span> (</span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="kw">SELECT</span> @row_index<span class="op">:=</span>@row_index <span class="op">+</span> <span class="dv">1</span> <span class="kw">AS</span> row_index, alt</span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="kw">FROM</span> airports</span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> alt</span>
<span id="cb25-6"><a href="#cb25-6"></a>) <span class="kw">AS</span> subquery</span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="kw">WHERE</span> subquery.row_index <span class="kw">IN</span> (<span class="fu">FLOOR</span>(@row_index <span class="op">/</span> <span class="dv">2</span>), <span class="fu">CEIL</span>(@row_index <span class="op">/</span> <span class="dv">2</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
1 records
</caption>
<thead>
<tr>
<th style="text-align:right;">
median_value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
476
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="median-8" class="slide level2 scrollable">
<h2>Median</h2>
<p>Take-aways:</p>
<ol type="1">
<li><p><strong>dbplyr</strong> is not able to translate the <code>median()</code> function into <strong>SQL</strong>.</p></li>
<li><p>The median is actually really hard to calculate! In particular, it is hard to calculate the median in one pass through the data.</p></li>
</ol>
</section>
<section id="case-when-and-ifelse" class="slide level2 scrollable">
<h2><code>CASE WHEN</code> and <code>ifelse()</code></h2>
<p>Consider the various R functions that create new variables based on an original variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>airports <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">mutate</span>(<span class="at">sea =</span> <span class="fu">ifelse</span>(alt <span class="sc">&gt;</span> <span class="dv">500</span>, <span class="st">"above sea"</span>, <span class="st">"near sea"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [5 x 10]
# Database: mysql  [mdsr_public@mdsr.cdc7tgkkqd0n.us-east-1.rds.amazonaws.com:NA/airlines]
  faa   name                     lat   lon   alt    tz dst   city  country sea  
  &lt;chr&gt; &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;
1 04G   Lansdowne Airport       41.1 -80.6  1044    -5 A     Youn… United… abov…
2 06A   Moton Field Municipal…  32.5 -85.7   264    -6 A     Tusk… United… near…
3 06C   Schaumburg Regional     42.0 -88.1   801    -6 A     Scha… United… abov…
4 06N   Randall Airport         41.4 -74.4   523    -5 A     Midd… United… abov…
5 09J   Jekyll Island Airport   31.1 -81.4    11    -5 A     Jeky… United… near…</code></pre>
</div>
</div>
</section>
<section id="case-when-and-ifelse-1" class="slide level2 scrollable">
<h2><code>CASE WHEN</code> and <code>ifelse()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>if_query <span class="ot">&lt;-</span> airports <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">mutate</span>(<span class="at">sea =</span> <span class="fu">ifelse</span>(alt <span class="sc">&gt;</span> <span class="dv">500</span>, <span class="st">"above sea"</span>, <span class="st">"near sea"</span>))</span>
<span id="cb28-3"><a href="#cb28-3"></a></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="fu">show_query</span>(if_query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT
  *,
  CASE WHEN (`alt` &gt; 500.0) THEN 'above sea' WHEN NOT (`alt` &gt; 500.0) THEN 'near sea' END AS `sea`
FROM `airports`</code></pre>
</div>
</div>
</section>
<section id="case-when-and-ifelse-2" class="slide level2 scrollable">
<h2><code>CASE WHEN</code> and <code>ifelse()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">SELECT</span> <span class="op">*</span>,</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="cf">CASE</span> <span class="cf">WHEN</span> (`alt` <span class="op">&gt;</span> <span class="fl">500.0</span>) <span class="cf">THEN</span> <span class="st">'above sea'</span> <span class="cf">WHEN</span> <span class="kw">NOT</span> (`alt` <span class="op">&gt;</span> <span class="fl">500.0</span>) <span class="cf">THEN</span> <span class="st">'near sea'</span> <span class="cf">END</span> <span class="kw">AS</span> `sea`</span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="kw">FROM</span> `airports` </span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="kw">LIMIT</span> <span class="dv">5</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
5 records
</caption>
<thead>
<tr>
<th style="text-align:left;">
faa
</th>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
lat
</th>
<th style="text-align:right;">
lon
</th>
<th style="text-align:right;">
alt
</th>
<th style="text-align:right;">
tz
</th>
<th style="text-align:left;">
dst
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
sea
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
04G
</td>
<td style="text-align:left;">
Lansdowne Airport
</td>
<td style="text-align:right;">
41.1
</td>
<td style="text-align:right;">
-80.6
</td>
<td style="text-align:right;">
1044
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Youngstown
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
above sea
</td>
</tr>
<tr>
<td style="text-align:left;">
06A
</td>
<td style="text-align:left;">
Moton Field Municipal Airport
</td>
<td style="text-align:right;">
32.5
</td>
<td style="text-align:right;">
-85.7
</td>
<td style="text-align:right;">
264
</td>
<td style="text-align:right;">
-6
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Tuskegee
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
near sea
</td>
</tr>
<tr>
<td style="text-align:left;">
06C
</td>
<td style="text-align:left;">
Schaumburg Regional
</td>
<td style="text-align:right;">
42.0
</td>
<td style="text-align:right;">
-88.1
</td>
<td style="text-align:right;">
801
</td>
<td style="text-align:right;">
-6
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Schaumburg
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
above sea
</td>
</tr>
<tr>
<td style="text-align:left;">
06N
</td>
<td style="text-align:left;">
Randall Airport
</td>
<td style="text-align:right;">
41.4
</td>
<td style="text-align:right;">
-74.4
</td>
<td style="text-align:right;">
523
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Middletown
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
above sea
</td>
</tr>
<tr>
<td style="text-align:left;">
09J
</td>
<td style="text-align:left;">
Jekyll Island Airport
</td>
<td style="text-align:right;">
31.1
</td>
<td style="text-align:right;">
-81.4
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Jekyll Island
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
near sea
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="case-when-and-case_when" class="slide level2 scrollable">
<h2><code>CASE WHEN</code> and <code>case_when()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>airports <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="fu">mutate</span>(<span class="at">sea =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-3"><a href="#cb31-3"></a>    alt <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"near sea"</span>,</span>
<span id="cb31-4"><a href="#cb31-4"></a>    alt <span class="sc">&lt;</span> <span class="dv">2000</span> <span class="sc">~</span> <span class="st">"low alt"</span>,</span>
<span id="cb31-5"><a href="#cb31-5"></a>    alt <span class="sc">&lt;</span> <span class="dv">3000</span> <span class="sc">~</span> <span class="st">"mod alt"</span>,</span>
<span id="cb31-6"><a href="#cb31-6"></a>    alt <span class="sc">&lt;</span> <span class="dv">5500</span> <span class="sc">~</span> <span class="st">"high alt"</span>,</span>
<span id="cb31-7"><a href="#cb31-7"></a>    alt <span class="sc">&gt;</span> <span class="dv">5500</span> <span class="sc">~</span> <span class="st">"extreme alt"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [5 x 10]
# Database: mysql  [mdsr_public@mdsr.cdc7tgkkqd0n.us-east-1.rds.amazonaws.com:NA/airlines]
  faa   name                     lat   lon   alt    tz dst   city  country sea  
  &lt;chr&gt; &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;
1 04G   Lansdowne Airport       41.1 -80.6  1044    -5 A     Youn… United… low …
2 06A   Moton Field Municipal…  32.5 -85.7   264    -6 A     Tusk… United… near…
3 06C   Schaumburg Regional     42.0 -88.1   801    -6 A     Scha… United… low …
4 06N   Randall Airport         41.4 -74.4   523    -5 A     Midd… United… low …
5 09J   Jekyll Island Airport   31.1 -81.4    11    -5 A     Jeky… United… near…</code></pre>
</div>
</div>
</section>
<section id="case-when-and-case_when-1" class="slide level2 scrollable">
<h2><code>CASE WHEN</code> and <code>case_when()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>cw_query <span class="ot">&lt;-</span> airports <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">mutate</span>(<span class="at">sea =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-3"><a href="#cb33-3"></a>    alt <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"near sea"</span>,</span>
<span id="cb33-4"><a href="#cb33-4"></a>    alt <span class="sc">&lt;</span> <span class="dv">2000</span> <span class="sc">~</span> <span class="st">"low alt"</span>,</span>
<span id="cb33-5"><a href="#cb33-5"></a>    alt <span class="sc">&lt;</span> <span class="dv">3000</span> <span class="sc">~</span> <span class="st">"mod alt"</span>,</span>
<span id="cb33-6"><a href="#cb33-6"></a>    alt <span class="sc">&lt;</span> <span class="dv">5500</span> <span class="sc">~</span> <span class="st">"high alt"</span>,</span>
<span id="cb33-7"><a href="#cb33-7"></a>    alt <span class="sc">&gt;</span> <span class="dv">5500</span> <span class="sc">~</span> <span class="st">"extreme alt"</span>))</span>
<span id="cb33-8"><a href="#cb33-8"></a></span>
<span id="cb33-9"><a href="#cb33-9"></a><span class="fu">show_query</span>(cw_query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT
  *,
  CASE
WHEN (`alt` &lt; 500.0) THEN 'near sea'
WHEN (`alt` &lt; 2000.0) THEN 'low alt'
WHEN (`alt` &lt; 3000.0) THEN 'mod alt'
WHEN (`alt` &lt; 5500.0) THEN 'high alt'
WHEN (`alt` &gt; 5500.0) THEN 'extreme alt'
END AS `sea`
FROM `airports`</code></pre>
</div>
</div>
</section>
<section id="case-when-and-case_when-2" class="slide level2 scrollable">
<h2><code>CASE WHEN</code> and <code>case_when()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">SELECT</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="op">*</span>,</span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="cf">CASE</span></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="cf">WHEN</span> (`alt` <span class="op">&lt;</span> <span class="fl">500.0</span>) <span class="cf">THEN</span> <span class="st">'near sea'</span></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="cf">WHEN</span> (`alt` <span class="op">&lt;</span> <span class="fl">2000.0</span>) <span class="cf">THEN</span> <span class="st">'low alt'</span></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="cf">WHEN</span> (`alt` <span class="op">&lt;</span> <span class="fl">3000.0</span>) <span class="cf">THEN</span> <span class="st">'mod alt'</span></span>
<span id="cb35-7"><a href="#cb35-7"></a><span class="cf">WHEN</span> (`alt` <span class="op">&lt;</span> <span class="fl">5500.0</span>) <span class="cf">THEN</span> <span class="st">'high alt'</span></span>
<span id="cb35-8"><a href="#cb35-8"></a><span class="cf">WHEN</span> (`alt` <span class="op">&gt;</span> <span class="fl">5500.0</span>) <span class="cf">THEN</span> <span class="st">'extreme alt'</span></span>
<span id="cb35-9"><a href="#cb35-9"></a><span class="cf">END</span> <span class="kw">AS</span> `sea`</span>
<span id="cb35-10"><a href="#cb35-10"></a><span class="kw">FROM</span> `airports`</span>
<span id="cb35-11"><a href="#cb35-11"></a><span class="kw">LIMIT</span> <span class="dv">5</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
5 records
</caption>
<thead>
<tr>
<th style="text-align:left;">
faa
</th>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
lat
</th>
<th style="text-align:right;">
lon
</th>
<th style="text-align:right;">
alt
</th>
<th style="text-align:right;">
tz
</th>
<th style="text-align:left;">
dst
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
sea
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
04G
</td>
<td style="text-align:left;">
Lansdowne Airport
</td>
<td style="text-align:right;">
41.1
</td>
<td style="text-align:right;">
-80.6
</td>
<td style="text-align:right;">
1044
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Youngstown
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
low alt
</td>
</tr>
<tr>
<td style="text-align:left;">
06A
</td>
<td style="text-align:left;">
Moton Field Municipal Airport
</td>
<td style="text-align:right;">
32.5
</td>
<td style="text-align:right;">
-85.7
</td>
<td style="text-align:right;">
264
</td>
<td style="text-align:right;">
-6
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Tuskegee
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
near sea
</td>
</tr>
<tr>
<td style="text-align:left;">
06C
</td>
<td style="text-align:left;">
Schaumburg Regional
</td>
<td style="text-align:right;">
42.0
</td>
<td style="text-align:right;">
-88.1
</td>
<td style="text-align:right;">
801
</td>
<td style="text-align:right;">
-6
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Schaumburg
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
low alt
</td>
</tr>
<tr>
<td style="text-align:left;">
06N
</td>
<td style="text-align:left;">
Randall Airport
</td>
<td style="text-align:right;">
41.4
</td>
<td style="text-align:right;">
-74.4
</td>
<td style="text-align:right;">
523
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Middletown
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
low alt
</td>
</tr>
<tr>
<td style="text-align:left;">
09J
</td>
<td style="text-align:left;">
Jekyll Island Airport
</td>
<td style="text-align:right;">
31.1
</td>
<td style="text-align:right;">
-81.4
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Jekyll Island
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
near sea
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="case-when-and-cut" class="slide level2 scrollable">
<h2><code>CASE WHEN</code> and <code>cut()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>airports <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">mutate</span>(<span class="at">sea =</span> <span class="fu">cut</span>(</span>
<span id="cb36-3"><a href="#cb36-3"></a>    alt,</span>
<span id="cb36-4"><a href="#cb36-4"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">500</span>, <span class="dv">2000</span>, <span class="dv">3000</span>, <span class="dv">5500</span>, <span class="cn">Inf</span>),</span>
<span id="cb36-5"><a href="#cb36-5"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"near sea"</span>, <span class="st">"low alt"</span>, <span class="st">"mod alt"</span>, <span class="st">"high alt"</span>, <span class="st">"extreme alt"</span>)</span>
<span id="cb36-6"><a href="#cb36-6"></a>  )</span>
<span id="cb36-7"><a href="#cb36-7"></a>)<span class="sc">|&gt;</span></span>
<span id="cb36-8"><a href="#cb36-8"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [5 x 10]
# Database: mysql  [mdsr_public@mdsr.cdc7tgkkqd0n.us-east-1.rds.amazonaws.com:NA/airlines]
  faa   name                     lat   lon   alt    tz dst   city  country sea  
  &lt;chr&gt; &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;
1 04G   Lansdowne Airport       41.1 -80.6  1044    -5 A     Youn… United… low …
2 06A   Moton Field Municipal…  32.5 -85.7   264    -6 A     Tusk… United… near…
3 06C   Schaumburg Regional     42.0 -88.1   801    -6 A     Scha… United… low …
4 06N   Randall Airport         41.4 -74.4   523    -5 A     Midd… United… low …
5 09J   Jekyll Island Airport   31.1 -81.4    11    -5 A     Jeky… United… near…</code></pre>
</div>
</div>
</section>
<section id="case-when-and-cut-1" class="slide level2 scrollable">
<h2><code>CASE WHEN</code> and <code>cut()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>cw_query <span class="ot">&lt;-</span> airports <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="fu">mutate</span>(<span class="at">sea =</span> <span class="fu">cut</span>(</span>
<span id="cb38-3"><a href="#cb38-3"></a>    alt,</span>
<span id="cb38-4"><a href="#cb38-4"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">500</span>, <span class="dv">2000</span>, <span class="dv">3000</span>, <span class="dv">5500</span>, <span class="cn">Inf</span>),</span>
<span id="cb38-5"><a href="#cb38-5"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"near sea"</span>, <span class="st">"low alt"</span>, <span class="st">"mod alt"</span>, <span class="st">"high alt"</span>, <span class="st">"extreme alt"</span>)</span>
<span id="cb38-6"><a href="#cb38-6"></a>  )</span>
<span id="cb38-7"><a href="#cb38-7"></a>)</span>
<span id="cb38-8"><a href="#cb38-8"></a></span>
<span id="cb38-9"><a href="#cb38-9"></a><span class="fu">show_query</span>(cw_query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT
  *,
  CASE
WHEN (`alt` &lt;= 500.0) THEN 'near sea'
WHEN (`alt` &lt;= 2000.0) THEN 'low alt'
WHEN (`alt` &lt;= 3000.0) THEN 'mod alt'
WHEN (`alt` &lt;= 5500.0) THEN 'high alt'
WHEN (`alt` &gt; 5500.0) THEN 'extreme alt'
END AS `sea`
FROM `airports`</code></pre>
</div>
</div>
</section>
<section id="case-when-and-cut-2" class="slide level2 scrollable">
<h2><code>CASE WHEN</code> and <code>cut()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">SELECT</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>  <span class="op">*</span>,</span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="cf">CASE</span></span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="cf">WHEN</span> (`alt` <span class="op">&lt;=</span> <span class="fl">500.0</span>) <span class="cf">THEN</span> <span class="st">'near sea'</span></span>
<span id="cb40-5"><a href="#cb40-5"></a><span class="cf">WHEN</span> (`alt` <span class="op">&lt;=</span> <span class="fl">2000.0</span>) <span class="cf">THEN</span> <span class="st">'low alt'</span></span>
<span id="cb40-6"><a href="#cb40-6"></a><span class="cf">WHEN</span> (`alt` <span class="op">&lt;=</span> <span class="fl">3000.0</span>) <span class="cf">THEN</span> <span class="st">'mod alt'</span></span>
<span id="cb40-7"><a href="#cb40-7"></a><span class="cf">WHEN</span> (`alt` <span class="op">&lt;=</span> <span class="fl">5500.0</span>) <span class="cf">THEN</span> <span class="st">'high alt'</span></span>
<span id="cb40-8"><a href="#cb40-8"></a><span class="cf">WHEN</span> (`alt` <span class="op">&gt;</span> <span class="fl">5500.0</span>) <span class="cf">THEN</span> <span class="st">'extreme alt'</span></span>
<span id="cb40-9"><a href="#cb40-9"></a><span class="cf">END</span> <span class="kw">AS</span> `sea`</span>
<span id="cb40-10"><a href="#cb40-10"></a><span class="kw">FROM</span> `airports`</span>
<span id="cb40-11"><a href="#cb40-11"></a><span class="kw">LIMIT</span> <span class="dv">5</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
5 records
</caption>
<thead>
<tr>
<th style="text-align:left;">
faa
</th>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
lat
</th>
<th style="text-align:right;">
lon
</th>
<th style="text-align:right;">
alt
</th>
<th style="text-align:right;">
tz
</th>
<th style="text-align:left;">
dst
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
sea
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
04G
</td>
<td style="text-align:left;">
Lansdowne Airport
</td>
<td style="text-align:right;">
41.1
</td>
<td style="text-align:right;">
-80.6
</td>
<td style="text-align:right;">
1044
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Youngstown
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
low alt
</td>
</tr>
<tr>
<td style="text-align:left;">
06A
</td>
<td style="text-align:left;">
Moton Field Municipal Airport
</td>
<td style="text-align:right;">
32.5
</td>
<td style="text-align:right;">
-85.7
</td>
<td style="text-align:right;">
264
</td>
<td style="text-align:right;">
-6
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Tuskegee
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
near sea
</td>
</tr>
<tr>
<td style="text-align:left;">
06C
</td>
<td style="text-align:left;">
Schaumburg Regional
</td>
<td style="text-align:right;">
42.0
</td>
<td style="text-align:right;">
-88.1
</td>
<td style="text-align:right;">
801
</td>
<td style="text-align:right;">
-6
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Schaumburg
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
low alt
</td>
</tr>
<tr>
<td style="text-align:left;">
06N
</td>
<td style="text-align:left;">
Randall Airport
</td>
<td style="text-align:right;">
41.4
</td>
<td style="text-align:right;">
-74.4
</td>
<td style="text-align:right;">
523
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Middletown
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
low alt
</td>
</tr>
<tr>
<td style="text-align:left;">
09J
</td>
<td style="text-align:left;">
Jekyll Island Airport
</td>
<td style="text-align:right;">
31.1
</td>
<td style="text-align:right;">
-81.4
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Jekyll Island
</td>
<td style="text-align:left;">
United States
</td>
<td style="text-align:left;">
near sea
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="distinct" class="slide level2 scrollable">
<h2><code>distinct()</code></h2>
<p>How many distinct time zones are there in the <code>airports</code> table?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>airports <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">select</span>(tz) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [?? x 1]
# Database: mysql  [mdsr_public@mdsr.cdc7tgkkqd0n.us-east-1.rds.amazonaws.com:NA/airlines]
     tz
  &lt;int&gt;
1    -5
2    -6
3    -8
4    -7
5    -9
6   -10
# ℹ more rows</code></pre>
</div>
</div>
</section>
<section id="distinct-1" class="slide level2 scrollable">
<h2><code>distinct()</code></h2>
<p>How many distinct time zones are there in the <code>airports</code> table?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>dist_query <span class="ot">&lt;-</span> airports <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>  <span class="fu">select</span>(tz) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3"></a>  <span class="fu">distinct</span>()</span>
<span id="cb43-4"><a href="#cb43-4"></a></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="fu">show_query</span>(dist_query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT DISTINCT `tz`
FROM `airports`</code></pre>
</div>
</div>
</section>
<section id="distinct-2" class="slide level2 scrollable">
<h2><code>distinct()</code></h2>
<p>How many distinct time zones are there in the <code>airports</code> table?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb45-1"><a href="#cb45-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> `tz`</span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="kw">FROM</span> `airports`;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
7 records
</caption>
<thead>
<tr>
<th style="text-align:right;">
tz
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-5
</td>
</tr>
<tr>
<td style="text-align:right;">
-6
</td>
</tr>
<tr>
<td style="text-align:right;">
-8
</td>
</tr>
<tr>
<td style="text-align:right;">
-7
</td>
</tr>
<tr>
<td style="text-align:right;">
-9
</td>
</tr>
<tr>
<td style="text-align:right;">
-10
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="limit-as-head" class="slide level2 scrollable">
<h2><code>LIMIT</code> as <code>head()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>airports <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [5 x 9]
# Database: mysql  [mdsr_public@mdsr.cdc7tgkkqd0n.us-east-1.rds.amazonaws.com:NA/airlines]
  faa   name                           lat   lon   alt    tz dst   city  country
  &lt;chr&gt; &lt;chr&gt;                        &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  
1 04G   Lansdowne Airport             41.1 -80.6  1044    -5 A     Youn… United…
2 06A   Moton Field Municipal Airpo…  32.5 -85.7   264    -6 A     Tusk… United…
3 06C   Schaumburg Regional           42.0 -88.1   801    -6 A     Scha… United…
4 06N   Randall Airport               41.4 -74.4   523    -5 A     Midd… United…
5 09J   Jekyll Island Airport         31.1 -81.4    11    -5 A     Jeky… United…</code></pre>
</div>
</div>
</section>
<section id="limit-as-head-1" class="slide level2 scrollable">
<h2><code>LIMIT</code> as <code>head()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>head_query <span class="ot">&lt;-</span> airports <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb48-3"><a href="#cb48-3"></a></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="fu">show_query</span>(head_query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT *
FROM `airports`
LIMIT 5</code></pre>
</div>
</div>
</section>
<section id="limit-as-head-2" class="slide level2 scrollable">
<h2><code>LIMIT</code> as <code>head()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb50-1"><a href="#cb50-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="kw">FROM</span> `airports`</span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="kw">LIMIT</span> <span class="dv">5</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
5 records
</caption>
<thead>
<tr>
<th style="text-align:left;">
faa
</th>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
lat
</th>
<th style="text-align:right;">
lon
</th>
<th style="text-align:right;">
alt
</th>
<th style="text-align:right;">
tz
</th>
<th style="text-align:left;">
dst
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
country
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
04G
</td>
<td style="text-align:left;">
Lansdowne Airport
</td>
<td style="text-align:right;">
41.1
</td>
<td style="text-align:right;">
-80.6
</td>
<td style="text-align:right;">
1044
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Youngstown
</td>
<td style="text-align:left;">
United States
</td>
</tr>
<tr>
<td style="text-align:left;">
06A
</td>
<td style="text-align:left;">
Moton Field Municipal Airport
</td>
<td style="text-align:right;">
32.5
</td>
<td style="text-align:right;">
-85.7
</td>
<td style="text-align:right;">
264
</td>
<td style="text-align:right;">
-6
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Tuskegee
</td>
<td style="text-align:left;">
United States
</td>
</tr>
<tr>
<td style="text-align:left;">
06C
</td>
<td style="text-align:left;">
Schaumburg Regional
</td>
<td style="text-align:right;">
42.0
</td>
<td style="text-align:right;">
-88.1
</td>
<td style="text-align:right;">
801
</td>
<td style="text-align:right;">
-6
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Schaumburg
</td>
<td style="text-align:left;">
United States
</td>
</tr>
<tr>
<td style="text-align:left;">
06N
</td>
<td style="text-align:left;">
Randall Airport
</td>
<td style="text-align:right;">
41.4
</td>
<td style="text-align:right;">
-74.4
</td>
<td style="text-align:right;">
523
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Middletown
</td>
<td style="text-align:left;">
United States
</td>
</tr>
<tr>
<td style="text-align:left;">
09J
</td>
<td style="text-align:left;">
Jekyll Island Airport
</td>
<td style="text-align:right;">
31.1
</td>
<td style="text-align:right;">
-81.4
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-5
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Jekyll Island
</td>
<td style="text-align:left;">
United States
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="ggplot" class="slide level2 scrollable">
<h2><code>ggplot()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>airports <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="2024-01-18-db-etc_files/figure-revealjs/unnamed-chunk-39-1.png" style="width:90.0%" class="r-stretch"></section>
<section id="ggplot-1" class="slide level2 scrollable">
<h2><code>ggplot()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>airports <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>  <span class="fu">filter</span>(lon <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="2024-01-18-db-etc_files/figure-revealjs/unnamed-chunk-40-1.png" style="width:90.0%" class="r-stretch"></section>
<section id="ggplot-2" class="slide level2 scrollable">
<h2><code>ggplot()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>gg_query <span class="ot">&lt;-</span> airports <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>  <span class="fu">filter</span>(lon <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb53-5"><a href="#cb53-5"></a></span>
<span id="cb53-6"><a href="#cb53-6"></a><span class="fu">show_query</span>(gg_query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in UseMethod("show_query"): no applicable method for 'show_query' applied to an object of class "c('gg', 'ggplot')"</code></pre>
</div>
</div>
</section>
<section id="take-away-message" class="slide level2">
<h2>Take-away message</h2>
<ul>
<li><p><strong>dbplyr</strong> is awesome and can often be helpful in figuring out <strong>SQL</strong> syntax</p></li>
<li><p>sometimes <strong>dbplyr</strong> will provide <strong>SQL</strong> syntax that does not work (see the median example)</p></li>
<li><p>sometimes there is no <strong>SQL</strong> syntax to match the <strong>R</strong> task of interest (see ggplot)</p></li>
</ul>
</section>
<section id="best-practice" class="slide level2">
<h2>Best practice</h2>
<p>It is always a good idea to terminate the <strong>SQL</strong> connection when you are done with it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="fu">dbDisconnect</span>(con_air, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section" class="slide level2">
<h2>47</h2>
<p>Pomona’s number is 47, and I wanted to have a 47th slide.</p>


<img data-src="../images/st47sd47am47h.png" style="width:90.0%" alt="icon that says STATS, DATA, MATH but has a 47 replacing every instance of AT in the words.'." class="r-stretch quarto-figure-center"><p class="caption">Figure&nbsp;1: image credit: Jo Hardin</p><div class="footer footer-default">

</div>
</section>

    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>